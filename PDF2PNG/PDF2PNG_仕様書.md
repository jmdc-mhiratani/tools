# PDF2PNG/PDF2PPTX ツール 仕様書

## 1. プロジェクト概要

### 1.1 目的
PDFファイルをPNG画像またはPowerPointプレゼンテーション（PPTX）形式に変換するGUIツール。
主にスキャンされたPDF文書を扱いやすい形式に変換し、プレゼンテーション作成や画像処理での活用を可能にする。

### 1.2 対象ユーザー
- スキャンされたPDF文書を編集可能な形式に変換したいユーザー
- プレゼンテーション資料作成でPDF画像を活用したいユーザー
- 大量のPDFページを効率的に処理したいユーザー

## 2. 機能仕様

### 2.1 主要機能

#### 2.1.1 PDF → PNG変換
- **機能**: PDFの各ページを個別のPNG画像に変換
- **入力**: 任意のフォルダ内の全PDFファイル
- **出力**: **入力ファイルと同じフォルダ**に`{ファイル名}_{ページ番号}.png`形式で保存
- **特徴**:
  - スケール倍率設定可能（デフォルト: 1.5倍）
  - 縦長ページの自動横向き回転（オプション）
  - 高解像度出力対応
  - 読み込み元フォルダへの直接出力

#### 2.1.2 PDF → PPTX変換（A3横サイズ）
- **機能**: PDFページをA3横サイズ（420×297mm）のスライドに実寸配置
- **入力**: 任意のフォルダ内の全PDFファイル
- **出力**: **入力ファイルと同じフォルダ**に`{最初のPDFファイル名}.pptx`形式で保存
- **特徴**:
  - 各ページが個別のスライドになる
  - 画像をスライド中央に配置
  - ファイル名・ページ番号ラベル付き
  - 縦長ページの自動90°回転
  - **カスタマイズ可能なラベルデザイン**（フォント、色設定）

#### 2.1.3 フォルダ選択・管理
- **機能**: 変換対象フォルダの選択と初期化
- **フォルダ選択**: 任意のフォルダを選択可能（フォルダ選択ダイアログ）
- **動作**:
  - 選択されたフォルダ内のPDFファイルを検索・変換
  - 変換結果は同じフォルダに出力
  - フォルダクリア機能（オプション）

### 2.2 GUI機能

#### 2.2.1 操作パネル
- **スケール倍率設定**: 数値入力フィールド（デフォルト: 1.5）
- **自動回転チェックボックス**: 縦長ページの横向き回転を制御
- **PowerPointラベル設定**:
  - **フォント設定**: フォント名選択（デフォルト: 游ゴシック）
  - **フォントサイズ**: 数値入力（デフォルト: 18pt）
  - **文字色設定**: カラーピッカー（デフォルト: 白）
  - **背景色設定**: カラーピッカー（デフォルト: オレンジ #FF6600）
  - **枠線色設定**: カラーピッカー（デフォルト: 赤 #FF0000）
- **変換ボタン**:
  - 📁 フォルダ選択
  - 📄 PDF → PNG 変換
  - 📈 PDF → PPTX 変換 (A3 横)
  - 🧹 選択フォルダクリア（オプション）

#### 2.2.2 プログレス表示
- **フォルダ表示**: 選択されたフォルダパスの表示
- **プログレスバー**: 変換処理の進捗を表示
- **完了通知**: メッセージボックスで完了を通知
- **結果表示**: 完了時に変換元フォルダを自動で開く

## 3. 技術仕様

### 3.1 開発環境
- **言語**: Python 3.10+
- **GUI**: tkinter（標準ライブラリ）
- **配布**: PyInstaller対応（スタンドアロン実行ファイル作成可能）

### 3.2 依存ライブラリ
```python
PyMuPDF (fitz)  # PDF読み込み・画像化
python-pptx     # PowerPoint操作
Pillow (PIL)    # 画像処理
tkinter         # GUI（標準ライブラリ）
```

### 3.3 ファイル構成
```
PDF2PNG/
├── PDF2PPTX.py              # メインGUIアプリケーション
├── 1_image_PDF2IMG.py       # PDF→PNG変換（単体スクリプト）
├── 2_ppt_PAF2PPT.py        # PDF→PPTX変換（単体スクリプト）
├── reset.py                 # フォルダクリアスクリプト
├── PDF2PPTX.spec           # PyInstaller設定
├── config.json             # PowerPointラベル設定保存
└── dist/                   # 実行ファイル出力（ビルド後）

注意: Input/Outputフォルダは廃止され、ユーザーが任意のフォルダを選択
```

### 3.4 スクリプト詳細

#### 3.4.1 PDF2PPTX.py（メインアプリケーション）
- **役割**: 統合GUI付きアプリケーション
- **機能**: 全機能を統合し、ユーザビリティを重視
- **特徴**: 
  - プログレス表示
  - エラーハンドリング
  - 結果フォルダの自動オープン
  - PyInstaller対応

#### 3.4.2 1_image_PDF2IMG.py（PDF→PNG変換）
- **役割**: PDF→PNG変換の単体実行
- **機能**: スケール設定可能な画像変換
- **出力**: `{ファイル名}_{ページ番号}.png`

#### 3.4.3 2_ppt_PAF2PPT.py（PDF→PPTX変換）
- **役割**: PDF→PPTX変換の単体実行
- **機能**: 空白スライドに画像を中央配置
- **出力**: `combined_presentation.pptx`

#### 3.4.4 reset.py（フォルダ初期化）
- **役割**: Input/Outputフォルダのクリア
- **機能**: 安全なフォルダ内容削除・再作成

## 4. 動作仕様

### 4.1 処理フロー

#### 4.1.1 PDF → PNG変換フロー
1. フォルダ選択ダイアログで変換対象フォルダを指定
2. 選択フォルダ内のPDFファイル検索
3. 各PDFファイルを順次処理
4. 各ページを指定スケールで画像化
5. 縦長判定 → 必要に応じて90°回転
6. PNG形式で**同じフォルダ**に保存
7. プログレス更新
8. 完了通知 → 変換元フォルダオープン

#### 4.1.2 PDF → PPTX変換フロー
1. フォルダ選択ダイアログで変換対象フォルダを指定
2. PowerPointラベル設定の読み込み（config.json）
3. A3横サイズ（420×297mm）のプレゼンテーション作成
4. 各PDFの各ページを処理
5. 高解像度画像化（スケール倍率適用）
6. 縦長判定 → 必要に応じて90°回転
7. 新しいスライドに画像を中央配置
8. カスタマイズされたラベル追加（フォント・色設定適用）
9. PPTXファイルとして**同じフォルダ**に保存
10. 完了通知 → 変換元フォルダオープン

### 4.2 自動回転ロジック
```python
# 縦長判定
portrait = page.rect.width < page.rect.height

# 自動回転設定がONかつ縦長の場合
if AUTO_ROTATE_TO_LANDSCAPE and portrait:
    # 90度回転して横向きに変換
    rotate_angle = 90
```

### 4.3 サイズ計算

#### 4.3.1 PNG出力サイズ
```python
# スケール倍率適用
zoom_matrix = fitz.Matrix(scale_factor, scale_factor)
pix = page.get_pixmap(matrix=zoom_matrix)
```

#### 4.3.2 PPTX配置サイズ
```python
# EMU単位変換（1mm = 36000 EMU）
slide_width = mm_to_emu(420)   # A3横幅
slide_height = mm_to_emu(297)  # A3横高さ

# スライド内に収まるよう比率調整
scale_ratio = min(slide_width / img_width, slide_height / img_height, 1.0)
```

### 4.4 PowerPointラベル設定

#### 4.4.1 設定ファイル（config.json）
```json
{
  "powerpoint_label": {
    "font_name": "游ゴシック",
    "font_size": 18,
    "text_color": "#FFFFFF",
    "background_color": "#FF6600",
    "border_color": "#FF0000",
    "position": "top-left",
    "width_ratio": 0.3,
    "height_ratio": 0.06
  }
}
```

#### 4.4.2 ラベル適用ロジック
```python
# 設定ファイルから読み込み
config = load_label_config()

# ラベル要素作成
tb = slide.shapes.add_shape(
    MSO_AUTO_SHAPE_TYPE.RECTANGLE, 0, 0,
    int(slide_width * config.width_ratio),
    int(slide_height * config.height_ratio)
)

# 背景色・枠線色設定
tb.fill.solid()
tb.fill.fore_color.rgb = hex_to_rgb(config.background_color)
tb.line.color.rgb = hex_to_rgb(config.border_color)

# フォント設定
para.font.name = config.font_name
para.font.size = Pt(config.font_size)
para.font.color.rgb = hex_to_rgb(config.text_color)
```

## 5. 使用方法

### 5.1 基本操作手順

#### 5.1.1 GUI使用
1. PDF2PPTX.pyを実行
2. 📁「フォルダ選択」ボタンで変換対象フォルダを指定
3. スケール倍率を設定（推奨: 1.5）
4. 自動回転の要/不要を選択
5. PowerPointラベル設定を調整（フォント・色設定）
6. 希望する変換ボタンをクリック
7. 変換完了まで待機
8. 自動で開かれる変換元フォルダで結果確認

#### 5.1.2 コマンドライン使用
```bash
# メインアプリケーション
python PDF2PPTX.py

# 個別機能実行
python 1_image_PDF2IMG.py    # PNG変換のみ
python 2_ppt_PAF2PPT.py      # PPTX変換のみ
python reset.py              # フォルダクリア
```

### 5.2 実行ファイル作成
```bash
# PyInstallerでビルド
pyinstaller PDF2PPTX.spec

# 実行ファイル起動
./dist/PDF2PPTX.exe    # Windows
./dist/PDF2PPTX        # macOS/Linux
```

## 6. 制約事項・注意点

### 6.1 制約事項
- **ファイル形式**: 入力はPDFファイルのみ対応
- **フォルダ権限**: 変換対象フォルダへの読み書き権限が必要
- **フォント制限**: システムにインストールされているフォントのみ選択可能
- **メモリ使用量**: 大容量PDFファイルは大量メモリを消費する可能性
- **処理時間**: ページ数・解像度に比例して処理時間が増加

### 6.2 推奨環境
- **メモリ**: 4GB以上
- **ディスク容量**: 変換後ファイル用に十分な空き容量
- **PDF品質**: スキャン解像度300DPI以上推奨

### 6.3 注意点
- **上書き注意**: 選択フォルダ内の既存変換ファイルは上書きされる
- **フォルダ選択**: 重要なファイルが含まれるフォルダでは注意して実行
- **ファイル名**: 日本語ファイル名に対応しているが、環境によっては問題が発生する可能性
- **設定保存**: PowerPointラベル設定は`config.json`に自動保存される
- **一時ファイル**: 処理中に一時ファイルが作成されるが、完了時に自動削除

## 7. トラブルシューティング

### 7.1 よくある問題

#### 7.1.1 「PDFが見つかりません」エラー
- **原因**: 選択フォルダが空またはPDFファイルが存在しない
- **対処**: フォルダ選択でPDFファイルが含まれるフォルダを指定

#### 7.1.2 「フォルダが選択されていません」エラー
- **原因**: フォルダ選択を行わずに変換ボタンをクリック
- **対処**: 📁「フォルダ選択」ボタンで変換対象フォルダを指定

#### 7.1.3 「スケールは数値で指定してください」エラー
- **原因**: スケール入力欄に無効な値が入力されている
- **対処**: 1.0以上の数値を入力（例: 1.5, 2.0）

#### 7.1.4 「フォルダへの書き込み権限がありません」エラー
- **原因**: 選択フォルダへの書き込み権限が不足
- **対処**: 管理者権限で実行するか、書き込み可能なフォルダを選択

#### 7.1.5 「指定フォントが見つかりません」エラー
- **原因**: 設定されたフォントがシステムにインストールされていない
- **対処**: フォント設定でインストール済みフォントを選択

#### 7.1.6 メモリ不足エラー
- **原因**: 大容量PDFまたは高スケール設定による メモリ不足
- **対処**: スケール倍率を下げる、PDFファイルサイズを確認

### 7.2 パフォーマンス最適化
- **スケール設定**: 用途に応じて適切なスケール倍率を選択
  - プレビュー用: 1.0-1.5
  - 印刷用: 2.0-3.0
- **分割処理**: 大量ファイルは複数回に分けて処理
- **一時停止**: 他の作業中は変換処理を避ける

## 8. 今後の拡張予定

### 8.1 機能拡張案
- **対応形式拡張**: JPEG, TIFF等の画像形式出力対応
- **バッチ設定**: 複数の変換設定を保存・呼び出し
- **プレビュー機能**: 変換前のページプレビュー表示
- **クロップ機能**: 余白自動トリミング
- **ラベルテンプレート**: 複数のラベルデザインテンプレート保存
- **フォント管理**: カスタムフォントのインストール・管理

### 8.2 UI改善案
- **ドラッグ&ドロップ**: フォルダ・ファイル選択の簡素化
- **リアルタイムプレビュー**: ラベルデザインの即座プレビュー
- **カラーパレット**: よく使用する色の保存・呼び出し
- **設定プロファイル**: 用途別設定の保存・管理
- **ログ表示**: 詳細な処理ログの表示
- **多言語対応**: 英語版等の国際化対応

---

**文書バージョン**: 2.0
**作成日**: 2025年9月18日
**更新日**: 2025年9月18日
**対象バージョン**: PDF2PPTX v2.0（フォルダ選択・ラベルカスタマイズ対応版）

### 📝 変更履歴
- **v2.0 (2025-09-18)**:
  - 出力先を読み込みフォルダと同じに変更
  - PowerPointラベルのフォント・色設定機能追加
  - フォルダ選択機能追加
  - Input/Outputフォルダ固定仕様を廃止
  - config.json設定ファイル追加
- **v1.0 (2025-09-18)**: 初版作成