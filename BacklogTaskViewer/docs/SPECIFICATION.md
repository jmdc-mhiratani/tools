# Backlog個人タスク横断ビューア 開発仕様書

## 📋 プロジェクト概要

### プロジェクト名
**BacklogTaskViewer** (仮称)

### 目的
複数のBacklogプロジェクト（4〜20プロジェクト）にまたがる自分の担当タスクを、1画面で横断的に表示・管理するデスクトップアプリケーション。

### ターゲットユーザー
- 複数プロジェクトを掛け持ちする個人ユーザー
- チームメンバー個人がそれぞれ使用

### 開発方針
**Phase 1（本仕様書）**: 個人用タスク横断ビューア機能
**Phase 2（別プロジェクト）**: チーム管理・進捗レポート機能
**Phase 3（別プロジェクト）**: データ分析・一括編集機能

---

## 🎯 Phase 1: 主要機能（個人タスクビューア）

### 1.1 コア機能

#### タスク取得・表示
- **対象**: 自分が担当者となっているタスク
- **取得範囲**: 選択した複数プロジェクト
- **表示項目**:
  - タスク件名
  - プロジェクト名
  - 期限日
  - ステータス（未対応/処理中/処理済み/完了）
  - 優先度
  - カテゴリー
  - マイルストーン
  - 最終更新日時

#### フィルタリング・ソート機能
- **期限フィルタ**:
  - 今日
  - 今週（月〜日）
  - 今月
  - 期限切れ
  - 期限未設定
  - カスタム期間
- **ステータスフィルタ**: 複数選択可
- **プロジェクトフィルタ**: 複数選択可
- **優先度フィルタ**: 複数選択可
- **ソート**: 期限日/更新日/プロジェクト/優先度

#### リフレッシュ機能
- **手動更新**: ボタンクリック
- **自動更新**: 設定可能（5/10/15/30/60分間隔）
- **最終更新時刻表示**

### 1.2 UI設計

#### メインウィンドウ構成
```
┌─────────────────────────────────────────────────┐
│ BacklogTaskViewer                    [−][□][×] │
├─────────────────────────────────────────────────┤
│ [設定] [更新] [エクスポート]    最終更新: 10:30 │
├─────────────────────────────────────────────────┤
│ フィルタ:                                       │
│ [期限: 今週▼] [ステータス: すべて▼]           │
│ [プロジェクト: すべて▼] [優先度: すべて▼]     │
├─────────────────────────────────────────────────┤
│ タスク一覧 (30件)               [ソート: 期限▼]│
│ ┌───────────────────────────────────────────┐   │
│ │ ⚠ 期限切れ (5件)                          │   │
│ │ ├ [高] プロジェクトA | タスク名1 (10/3)   │   │
│ │ └ [中] プロジェクトB | タスク名2 (10/4)   │   │
│ │                                            │   │
│ │ 📅 今日 (3件)                             │   │
│ │ ├ [高] プロジェクトC | タスク名3          │   │
│ │ └ [低] プロジェクトA | タスク名4          │   │
│ │                                            │   │
│ │ 📆 今週 (10件)                            │   │
│ │ ├ [中] プロジェクトD | タスク名5 (10/8)   │   │
│ │ └ ...                                      │   │
│ └───────────────────────────────────────────┘   │
│                                                 │
│ [詳細パネル]                                    │
│ 選択中: プロジェクトA | タスク名1               │
│ 期限: 2025/10/3 | 状態: 未対応 | 優先度: 高    │
│ [Backlogで開く]                                 │
└─────────────────────────────────────────────────┘
```

#### カラーコーディング
- **期限切れ**: 赤背景
- **今日**: オレンジ強調
- **優先度**: 高=赤、中=黄、低=緑のアイコン
- **ステータス**: 未対応/処理中/処理済み/完了で色分け

### 1.3 設定画面

#### 接続設定
- **スペースID**: `yourspace.backlog.jp` の `yourspace` 部分
- **APIキー**: テキストボックス（マスク表示）
- **接続テスト**: ボタンで疎通確認

#### プロジェクト選択
- **取得可能プロジェクト一覧**: チェックボックスで選択
- **選択状態の保存**: 次回起動時に復元

#### 表示設定
- **自動更新間隔**: ドロップダウン（無効/5/10/15/30/60分）
- **起動時の期限フィルタ**: デフォルト値設定
- **タスク表示件数**: 制限設定（デフォルト100件）

#### セキュリティ設定
- **APIキー暗号化**: ローカルに安全に保存
- **タイムアウト設定**: API呼び出しのタイムアウト秒数

---

## 🛠️ 技術仕様

### 開発環境
- **Python**: 3.13.7+
- **パッケージマネージャー**: `uv`
- **UIフレームワーク**: PySide6 (Qt for Python)
- **仮想環境**: プロジェクトローカルに構築

### 主要ライブラリ
```toml
[project]
name = "backlog-task-viewer"
version = "0.1.0"
requires-python = ">=3.13"
dependencies = [
    "PySide6>=6.8.0",
    "PySide6-Addons>=6.8.0",
    "PyBacklogPy>=0.10.0",  # Backlog API クライアント
    "python-dotenv>=1.0.0",  # 環境変数管理
    "keyring>=24.0.0",       # APIキーの安全な保存
    "pydantic>=2.0.0",       # データ検証
]

[project.optional-dependencies]
dev = [
    "pytest>=7.4.0",
    "black>=23.7.0",
    "ruff>=0.0.282",
    "mypy>=1.4.1",
    "pyinstaller>=5.13.0",
]
```

### プロジェクト構造
```
BacklogTaskViewer/
├── src/
│   ├── __init__.py
│   ├── main.py                 # エントリーポイント
│   ├── core/
│   │   ├── __init__.py
│   │   ├── backlog_client.py   # Backlog API ラッパー
│   │   ├── task_manager.py     # タスクデータ管理
│   │   ├── settings_manager.py # 設定管理
│   │   └── cache_manager.py    # キャッシュ管理
│   ├── ui/
│   │   ├── __init__.py
│   │   ├── main_window.py      # メインウィンドウ
│   │   ├── settings_dialog.py  # 設定ダイアログ
│   │   ├── task_list_widget.py # タスクリストウィジェット
│   │   └── components.py       # 共通UIコンポーネント
│   ├── utils/
│   │   ├── __init__.py
│   │   ├── crypto.py           # 暗号化ユーティリティ
│   │   ├── validators.py       # データ検証
│   │   └── logger.py           # ログ管理
│   └── models/
│       ├── __init__.py
│       ├── task.py             # タスクモデル
│       ├── project.py          # プロジェクトモデル
│       └── settings.py         # 設定モデル
├── tests/
│   ├── __init__.py
│   ├── test_backlog_client.py
│   ├── test_task_manager.py
│   └── test_validators.py
├── config/
│   └── settings.json           # デフォルト設定
├── docs/
│   ├── README.md
│   ├── USER_GUIDE.md
│   └── DEVELOPMENT.md
├── .env.example                # 環境変数テンプレート
├── .gitignore
├── pyproject.toml
├── README.md
└── CLAUDE.md                   # AI開発者向け詳細仕様
```

### データ管理

#### キャッシュ戦略
- **初回取得**: Backlog APIからフルデータ取得
- **差分更新**: 最終更新日時以降のタスクのみ取得
- **キャッシュ保存先**: `~/.backlog_task_viewer/cache/`
- **キャッシュ有効期限**: 設定された自動更新間隔

#### セキュリティ
- **APIキー保存**: `keyring` ライブラリで OS のクレデンシャルストアに保存
- **通信**: HTTPS のみ
- **ログ**: 個人情報をマスク

#### エラーハンドリング
- **ネットワークエラー**: リトライ機能（最大3回）
- **API制限**: レート制限を考慮した遅延処理
- **認証エラー**: ユーザーに再設定を促す

---

## 📊 データフロー

```
起動
 ↓
設定ファイル読み込み
 ↓
APIキー取得（keyring）
 ↓
Backlog API 接続
 ↓
プロジェクト一覧取得
 ↓
各プロジェクトのタスク取得（並列処理）
 ↓
タスクデータ統合・フィルタリング
 ↓
UI 表示
 ↓
自動更新タイマー起動
```

---

## 🎨 UI/UX 詳細設計

### PySide6 ウィジェット構成
- **QMainWindow**: メインウィンドウ
- **QTableWidget / QTreeWidget**: タスクリスト（検討中）
- **QComboBox**: フィルタドロップダウン
- **QDialog**: 設定ダイアログ
- **QSystemTrayIcon**: システムトレイアイコン（オプション）

### レスポンシブ対応
- **最小サイズ**: 1024x768
- **推奨サイズ**: 1280x800
- **分割比率**: リスト:詳細 = 7:3

---

## 🚀 開発フェーズ

### Phase 1.1: 基本ビューア（MVP）
- [ ] プロジェクト構造セットアップ
- [ ] Backlog API 接続実装
- [ ] シンプルなタスクリスト表示
- [ ] 設定画面（APIキー・プロジェクト選択）
- [ ] 手動更新機能

### Phase 1.2: フィルタ・ソート
- [ ] 期限フィルタ実装
- [ ] ステータスフィルタ実装
- [ ] ソート機能実装
- [ ] 詳細パネル実装

### Phase 1.3: 自動更新・キャッシュ
- [ ] 自動更新タイマー
- [ ] キャッシュ機能
- [ ] エラーハンドリング強化
- [ ] ログ機能

### Phase 1.4: UI改善・最適化
- [ ] カラーコーディング
- [ ] グループ表示（期限切れ/今日/今週）
- [ ] パフォーマンス最適化
- [ ] ユーザーフィードバック実装

### Phase 1.5: ビルド・リリース
- [ ] Windows実行ファイル作成
- [ ] ユーザーガイド作成
- [ ] テスト・デバッグ
- [ ] リリース

---

## 📝 将来の拡張（Phase 2以降）

### Phase 2: タスク操作機能（別プロジェクト）
- タスクのステータス変更
- コメント追加
- タスク作成
- 一括操作

### Phase 3: Google Spreadsheet連携（別プロジェクト）
- 定期的な進捗レポート自動出力
- データ分析用エクスポート
- タスクの一括インポート

### Phase 4: チーム管理機能（別プロジェクト）
- チーム全体のタスク俯瞰
- リソース配分の可視化
- 進捗レポート生成

---

## 🔧 開発環境セットアップ

### 初期セットアップ
```powershell
# プロジェクトディレクトリ作成
cd c:\workspace\apps
mkdir BacklogTaskViewer
cd BacklogTaskViewer

# pyproject.toml 作成後
uv sync

# 環境変数設定
cp .env.example .env
# .env を編集して BACKLOG_API_KEY を設定
```

### 開発コマンド
```powershell
# アプリケーション実行
uv run python src/main.py

# テスト実行
uv run pytest tests/ -v

# コードフォーマット
uv run black src/ tests/

# 型チェック
uv run mypy src/

# ビルド
python build.py
```

---

## 📚 参考情報

### Backlog API
- **ライブラリ**: [PyBacklogPy](https://github.com/kitadakyou/PyBacklogPy)
- **公式ドキュメント**: https://developer.nulab.com/ja/docs/backlog/
- **認証**: APIキー方式

### PySide6
- **公式ドキュメント**: https://doc.qt.io/qtforpython/
- **参考プロジェクト**: `c:\workspace\apps\PySide6_Sample`

---

## ✅ 次のステップ

1. **プロジェクト構造の作成**: ディレクトリ・ファイル構成を実装
2. **pyproject.toml の作成**: 依存関係定義
3. **Backlog API 接続テスト**: PyBacklogPy の動作確認
4. **基本UI実装**: PySide6 でメインウィンドウ作成
5. **MVP開発**: Phase 1.1 の実装開始

